# å½©äº‘å¤©æ°”MCPæœåŠ¡å™¨æµ‹è¯•æ€»ç»“

## âœ… æµ‹è¯•çŠ¶æ€

æ‰€æœ‰æ ¸å¿ƒå•å…ƒæµ‹è¯•å·²é€šè¿‡ï¼

```bash
Test Files  4 passed | 1 skipped (5)
     Tests  54 passed | 7 skipped (61)
```

## ğŸ“ æµ‹è¯•æ–‡ä»¶

| æ–‡ä»¶ | æµ‹è¯•æ•° | çŠ¶æ€ | è¯´æ˜ |
|-----|--------|------|------|
| `index.test.ts` | 3 | âœ… é€šè¿‡ | æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• |
| `tools.test.ts` | 27 | âœ… é€šè¿‡ | å·¥å…·åŠŸèƒ½è¯¦ç»†æµ‹è¯• |
| `mcp-server-simple.test.ts` | 18 | âœ… é€šè¿‡ | MCPæœåŠ¡å™¨æµ‹è¯• |
| `prompts.test.ts` | 6 | âœ… é€šè¿‡ | Promptç³»ç»Ÿæµ‹è¯• |
| `integration-live.test.ts` | 7 | â­ï¸ è·³è¿‡ | éœ€è¦APIå¯†é’¥ |

## ğŸš€ è¿è¡Œæµ‹è¯•

### ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pnpm test tests/tools.test.ts

# è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆä¸éœ€è¦APIå¯†é’¥ï¼‰
pnpm test -- --run tests/index.test.ts tests/tools.test.ts tests/mcp-server-simple.test.ts tests/prompts.test.ts

# è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦APIå¯†é’¥ï¼‰
CAIYUN_API_TOKEN=your_token pnpm test tests/integration-live.test.ts
```

### è¿è¡Œè„šæœ¬

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x tests/run-tests-pnpm.sh

# è¿è¡Œæµ‹è¯•
./tests/run-tests-pnpm.sh
```

## ğŸ”‘ APIå¯†é’¥é…ç½®

### æ–¹æ³•1: ç¯å¢ƒå˜é‡

```bash
export CAIYUN_API_TOKEN=your_api_token_here
pnpm test
```

### æ–¹æ³•2: å‘½ä»¤è¡Œä¼ å…¥

```bash
CAIYUN_API_TOKEN=your_token pnpm test tests/integration-live.test.ts
```

### æ–¹æ³•3: .envæ–‡ä»¶

åˆ›å»º `.env` æ–‡ä»¶ï¼š
```
CAIYUN_API_TOKEN=your_api_token_here
```

## ğŸ“Š æµ‹è¯•è¦†ç›–èŒƒå›´

### âœ… å·²è¦†ç›–åŠŸèƒ½

#### å·¥å…·æµ‹è¯• (tools.test.ts)
- **å®æ—¶å¤©æ°”** - 6ä¸ªæµ‹è¯•ç”¨ä¾‹
- **åˆ†é’Ÿçº§é™æ°´** - 2ä¸ªæµ‹è¯•ç”¨ä¾‹
- **å°æ—¶çº§é¢„æŠ¥** - 3ä¸ªæµ‹è¯•ç”¨ä¾‹
- **å¤©çº§é¢„æŠ¥** - 3ä¸ªæµ‹è¯•ç”¨ä¾‹
- **å¤©æ°”é¢„è­¦** - 2ä¸ªæµ‹è¯•ç”¨ä¾‹
- **ç»¼åˆå¤©æ°”** - 3ä¸ªæµ‹è¯•ç”¨ä¾‹
- **é”™è¯¯å¤„ç†** - 5ä¸ªæµ‹è¯•ç”¨ä¾‹
- **å‚æ•°éªŒè¯** - 3ä¸ªæµ‹è¯•ç”¨ä¾‹

#### MCPæœåŠ¡å™¨æµ‹è¯• (mcp-server-simple.test.ts)
- **æœåŠ¡å™¨åˆå§‹åŒ–** - 3ä¸ªæµ‹è¯•ç”¨ä¾‹
- **å·¥å…·é…ç½®** - 3ä¸ªæµ‹è¯•ç”¨ä¾‹
- **å‚æ•°è§„èŒƒåŒ–** - 4ä¸ªæµ‹è¯•ç”¨ä¾‹
- **APIè¯·æ±‚æ„å»º** - 2ä¸ªæµ‹è¯•ç”¨ä¾‹
- **é”™è¯¯å¤„ç†** - 4ä¸ªæµ‹è¯•ç”¨ä¾‹
- **å“åº”éªŒè¯** - 2ä¸ªæµ‹è¯•ç”¨ä¾‹

#### Promptç³»ç»Ÿæµ‹è¯• (prompts.test.ts)
- **åˆ—å‡ºæ‰€æœ‰prompts** - 1ä¸ªæµ‹è¯•ç”¨ä¾‹
- **ç”Ÿæˆé™æ€prompt** - 1ä¸ªæµ‹è¯•ç”¨ä¾‹
- **ç”ŸæˆåŠ¨æ€prompt** - 1ä¸ªæµ‹è¯•ç”¨ä¾‹
- **è·å–ç»Ÿè®¡ä¿¡æ¯** - 1ä¸ªæµ‹è¯•ç”¨ä¾‹
- **é”™è¯¯å¤„ç†** - 2ä¸ªæµ‹è¯•ç”¨ä¾‹

## ğŸ§ª æµ‹è¯•æ•°æ®

### Mockå“åº”ç¤ºä¾‹

```javascript
// å®æ—¶å¤©æ°”
{
  status: "ok",
  result: {
    realtime: {
      temperature: 25.5,
      humidity: 0.65,
      skycon: "PARTLY_CLOUDY_DAY",
      wind: { speed: 12.5, direction: 135 }
    }
  }
}
```

### æµ‹è¯•åæ ‡

- åŒ—äº¬: 116.3176, 39.9760
- ä¸Šæµ·: 121.4737, 31.2304
- å¹¿å·: 113.2644, 23.1291
- æ·±åœ³: 114.0579, 22.5431

## âš ï¸ å·²çŸ¥é—®é¢˜

1. **MaxListenersExceededWarning**: å¤šä¸ªæµ‹è¯•å¹¶å‘æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨çš„è­¦å‘Šï¼Œä¸å½±å“æµ‹è¯•ç»“æœ
2. **é›†æˆæµ‹è¯•éœ€è¦APIå¯†é’¥**: integration-live.test.ts éœ€è¦æœ‰æ•ˆçš„å½©äº‘APIå¯†é’¥æ‰èƒ½è¿è¡Œ

## ğŸ“ˆ æµ‹è¯•æ”¹è¿›å»ºè®®

1. æ·»åŠ æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š: `pnpm test -- --coverage`
2. æ·»åŠ æ›´å¤šè¾¹ç•Œæ¡ä»¶æµ‹è¯•
3. å®ç°E2Eæµ‹è¯•
4. æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
5. é…ç½®GitHub Actions CI/CD

## ğŸ‰ æ€»ç»“

æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–å®Œæ•´ï¼Œæ‰€æœ‰å·¥å…·å’ŒMCPåè®®åŠŸèƒ½å‡å·²éªŒè¯é€šè¿‡ã€‚é¡¹ç›®å¯ä»¥å®‰å…¨éƒ¨ç½²ä½¿ç”¨ï¼